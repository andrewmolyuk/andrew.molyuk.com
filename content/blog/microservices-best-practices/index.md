---
title: "Переходим на микросервисы"
date: 2023-07-18T09:51:45+03:00
blog/tags: [ "микросервисы", "best practices", "управление", "планирование" ]
cover:
  image: "14778621801.webp"
  title: "Our little men and women; modern methods of character building; (1912)"
  link: "https://commons.wikimedia.org/wiki/File:Our_little_men_and_women;_modern_methods_of_character_building;_(1912)_(14778621801).webp"
draft: false
---

В последние годы микросервисные архитектуры стали чрезвычайно популярными, и не зря. При правильном управлении они
улучшают масштабируемость, стимулируют более быструю разработку и внедрение, а также снижают связанность данных и
области. Компании всех размеров - от маленьких стартапов до крупных предприятий - мигрировали свои монолитные приложения
к микросервисным и сервис-ориентированным архитектурам.

Однако переход от монолита к микросервисам - это значительный шаг. Ваша команда должна быть готова к этому изменению как
на техническом, так и на организационном уровнях. Без тщательного обдумывания, неправильная миграция может вызвать
серьезные проблемы в будущем.

<!--more-->

Мы не являемся исключением и также мигрировали на микросервисную архитектуру. Я постараюсь описать те лучшие практики,
которые мы использовали или которые стоит учесть во время перехода к микросервисной архитектуре.

Все советы и практики несут сугубо рекомендательный характер и не являются единственно верными. Все зависит от вашего
проекта и вашей команды. Но я надеюсь, что эти советы помогут вам избежать некоторых ошибок, которые мы совершили.

## TL;DR

- Определитесь в необходимости перехода на микросервисную архитектуру
- Не переходите на микросервисы, если у вас нет поддержки всей компании
- Планируйте переход на микросервисы заранее
- Создайте прозрачное логирование и мониторинг всей системы
- Построив первый микросервис, создайте шаблон на его основе
- Назначьте ответственных за каждый микросервис
- Организуйте портал для разработчиков

А теперь давайте подробнее рассмотрим каждый пункт.

## Почему микросервисы?

Перед тем, как приступить к переходу на микросервисную архитектуру, необходимо убедиться, что ваша организация
действительно нуждается в ней. В интернете есть много статей, где рассматриваются плюсы и минусы монолитных архитектур
по сравнению с микросервисами. Я не буду их повторять, но отмечу основные моменты которые легли в основу нашего решения
о переходе на микросервисы. И если компании, такие как Amazon и Netflix, нашли ценность в микросервисах, не обязательно
означает, что ваша команда тоже извлечет выгоду из такого подхода. В некоторых случаях и для определенных команд
монолитные архитектуры могут предоставить преимущества своей простотой, и внедрение микросервисов может привнести
излишнюю сложность, которая не окупится в будущем.

Однако, как многие команды уже осознали, монолитная архитектура может приводить к серьезным проблемам. Монолиты могут
стать преградой для масштабирования, так как при запуске нескольких экземпляров приложения требуется репликация всего
кода. Микросервисы, напротив, позволяют оптимизировать использование ресурсов, развертывая только нужные сервисы.
Благодаря Docker и Kubernetes горизонтальное масштабирование становится простым и эффективным.

Еще одной проблемой монолитных архитектур является возникновение организационных сложностей. Неопределенные границы
между различными функциональными областями затрудняют написание кода без нежелательных взаимодействий с другими частями
системы. Согласование и координация между различными командами разработчиков может замедлять процесс разработки, так как
они вынуждены ожидать окончания развертывания других команд. Также велик размер кодовой базы монолитов, что может
существенно замедлять процесс тестирования и выпуска. В свою очередь, хорошее управление микросервисами позволяет
развязать функциональные области, упрощает процесс отладки и позволяет выпускать в продакшн только малые фрагменты
кода при каждом обновлении. Кроме того, микросервисы предоставляют возможность использовать различные языки
программирования и инструменты для каждого сервиса, что способствует улучшению производительности и эффективности
разработки. У нас есть сервисы, написанные на JavaScript и Go. И это никак не мешает нам разрабатывать их одновременно.

Наконец, микросервисы позволяют улучшить надежность системы. Если один из сервисов перестает работать, остальные могут
продолжать функционировать. Кроме того, микросервисы позволяют использовать различные базы данных для каждого сервиса,
что уменьшает связанность данных и функциональных областей.

## Получите поддержку всей организации

Миграции — и особенно переход к микросервисной архитектуре — это сложный процесс. Если вы запускаете один сервис и ваша
команда не поддерживает его, то в результате у вас просто появятся два монолита.

Для того чтобы действительно создать архитектуру, ориентированную на сервисы, невозможно полагаться только на одну
команду. Необходимо получить поддержку сверху вниз. Вся организация должна переосмыслить своё приложение, и команды
должны быть ориентированы на управление своими собственными сервисами.

Ключевым моментом для успешного прохождения данного процесса будет чёткое обоснование, которое отвечает потребностям
команды, так как именно это обеспечит поддержку и поддержание боевого духа на протяжении всего процесса.

Как известно, архитектура приложения должна отражать организационную структуру. Поэтому, если вы хотите перейти на новую
архитектуру, вам необходимо переосмыслить организационную структуру. В нашем случае мы решили перераспределить
вертикальную ответственность за различные функциональные области. Каждый член команды или команда отвечает за свой
собственный сервис, и может разрабатывать и разворачивать его независимо от других. Кроме того, мы определили новую роль
DevOps отвечающую за инфраструктуру и инструменты, которые используются всеми командами.

## Составьте план и следуйте ему

Несмотря на вдохновение и представление о светлом будущем, где команды работают с высокой скоростью, а автоматизация
позаботится о масштабировании, помните, что прежде всего необходимо пройти этот путь. Это путешествие может занять
больше времени, чем предполагается. По пути вы столкнетесь с неожиданными проблемами, и переход к распределенной
системе, даже если у членов команды есть опыт работы с микросервисами, потребует развития умения всей организации.
Привыкание к этим изменениям и понимание их последствий займет время, чтобы ваша организация эффективно функционировала
в новой архитектуре.

Поэтому подготовьте вашу систему для внедрения первых микросервисов и будьте готовы к внедрению новых впоследствии.
Имейте представление о том, куда вы направляетесь. Лучше заложить основу заранее, чтобы облегчить процесс миграции,
когда начнете его осуществлять.

Разработайте план для какой части вашего монолита вы сначала реализуете микросервисы. Понимайте, как превращение этих
частей вашего приложения в микросервисы повлияет на связанные сервисы, как внизу, так и вверху.

Вы можете начать с выделения одной команды или функциональной области в отдельный микросервис. Например, команда по
сбору и анализу данных, которая хочет работать на Go, может быть хорошим вариантом. Вы можете перенести всю их структуру
в микросервис, и предоставить возможность использовать все доступные инструменты и библиотеки. Также можно сначала
разделить монолит на более крупные макросервисы, например, переместив всю систему аутентификации в отдельный сервис. Это
позволяет команде определить необходимые интерфейсы на границах областей, оставив более детальную работу на более
поздний этап. Затратив время на начальную подготовку, вы избежите необходимости вносить изменения и повторно мигрировать
сервисы в дальнейшем.

Однако не стоит зацикливаться на оптимизации. Сосредоточьтесь на запуске основных элементов, оставив автоматизацию и
оркестрацию на потом.

## Подумайте о мониторинге заранее

Помимо создания сервисов, обратите внимание на то, как можно добавить логирование и мониторинг, чтобы облегчить
устранение проблем. Переход к микросервисной архитектуре вводит новый режим сбоев для ваших команд. Теперь, вместо того
чтобы функции вызывали другие функции внутри монолита, коммуникация будет осуществляться через внешние API-запросы.

Запросы могут завершаться неудачно из-за проблем с сетевым подключением. Сервисы могут быть недоступны. Введение
задержек и асинхронных вызовов может привести к неожиданному поведению. Без должной обработки таких ситуаций будет
трудно понять, что именно идет не так и почему. Продумайте эти режимы сбоев и обеспечьте прозрачность, чтобы узнавать о
проблемах, когда они возникают. Записывайте метрики, чтобы понимать распространенность проблем.

## Шаблонизируйте ваши микросервисы

Шаблонизация микросервисов — это процесс создания образцов или шаблонов, которые можно переиспользовать для
развертывания и создания новых микросервисов. Этот подход позволяет автоматизировать процесс создания сервисов с
предустановленной конфигурацией, что упрощает и ускоряет разработку и развертывание новых функциональностей.

С помощью шаблонов, вы можете стандартизировать настройки, библиотеки и зависимости микросервисов, что облегчит их
управление и обновление. Также, шаблонизация поможет уменьшить количество повторяющегося кода и снизить вероятность
ошибок, поскольку большая часть конфигурации будет уже предопределена.

Применение шаблонизации также способствует согласованности и схожести между микросервисами, что улучшит общую структуру
и архитектуру вашей системы. Вы сможете легко масштабировать и управлять вашими микросервисами, следуя одному и тому же
стандарту и подходу для каждого из них.

## Отслеживайте ответственность за микросервисы

Важно поддерживать четкую систему отслеживания ответственности за каждый микросервис в вашей архитектуре. Это означает,
что каждый микросервис должен быть привязан к конкретной команде или владельцу, который несет ответственность за его
разработку, обслуживание и поддержание.

Установление ясного владения микросервисами помогает в следующих аспектах:

- `Ясное понимание ответственности`: Когда каждый микросервис имеет своего владельца, становится ясно, кто отвечает за
  его функциональность, исправление ошибок и обновления. Это позволяет ускорить процесс разработки и развертывания, а
  также облегчить коммуникацию внутри команды.

- `Эффективное управление`: Отслеживание владения микросервисами помогает контролировать, кто отвечает за принятие
  решений относительно его развития и улучшения. Это позволяет эффективно управлять приоритетами и ресурсами для
  каждого микросервиса.

- `Снижение рисков`: Когда у каждого микросервиса есть явно определенный владелец, риски относительно незавершенных
  задач и проблем минимизируются. Команда владельца будет более склонна и ответственна за свои сервисы и постарается
  предотвратить возможные проблемы.

- `Развитие экспертного знания`: Каждый владелец микросервиса сможет стать экспертом в своей области, что повышает общую
  компетентность и эффективность команды в целом.

Чтобы обеспечить успешную реализацию и владение микросервисами, необходимо определить четкие процессы коммуникации и
сотрудничества между владельцами микросервисов и другими командами в организации. В идеале, каждый микросервис должен
иметь свою собственную команду, которая будет отвечать за его разработку и поддержку. Не распыляйте ответственность за
микросервисы между несколькими командами, поскольку это может привести к конфликтам и неэффективности.

## Создайте портал для разработчиков

Команды часто беспокоятся о росте числа микросервисов при их разработке. Если не управлять этим процессом должным
образом, разработчики могут потерять контроль над всеми микросервисами, и никто не будет точно знать, что происходит.
Поэтому обязательно наладьте строгий механизм отслеживания ваших микросервисов.

Вы можете создать портал для разработчиков, который позволит легко создавать новые микросервисы, получать информацию об
уже существующих сервисах и предоставлять информацию о ваших сервисах. Это облегчит поддержку всех ваших сервисов и
обеспечит видимость их производительности, владельцев и метаданных.

При наличии такого портала команды смогут более эффективно управлять микросервисами, быстро создавать их по
необходимости и получать доступ к всей необходимой информации о каждом сервисе. Такой подход позволит избежать ненужного
размножения микросервисов и обеспечит их более прозрачное и эффективное управление.

Создайте информационную страницу для всей системы в целом, которая будет отображать общую информацию о микросервисах,
такую как их количество, состояние, данные о владельце, метаданные и т.д. Это поможет вам лучше понять вашу систему и ее
производительность.

## Заключение

Микросервисная архитектура может быть очень полезной для вашей организации, если вы правильно ее реализуете. Однако,
если вы не будете следовать правильным практикам, вы можете столкнуться с некоторыми проблемами, которые могут негативно
повлиять на вашу систему в целом. Поэтому важно следовать правилам и рекомендациям, чтобы извлечь максимальную выгоду из
этой архитектуры. В этой статье мы рассмотрели некоторые из таких правил и рекомендаций, которые помогут вам мигрировать
или создать новую микросервисную архитектуру.

Надеюсь, эта статья поможет вам избежать некоторых распространенных ошибок и сделает вашу систему более эффективной и
масштабируемой. Если у вас есть какие-либо вопросы или замечания по этой статье, пожалуйста, оставьте их в комментариях
ниже.
