{{ define "main" }}
<main class="container my-24 px-6 mx-auto">
  <section class="mb-32 text-gray-800">

    {{ $image := (.Resources.Get .Params.Cover.Image).Crop "1600x400 webp" }}
    <img src="{{ $image.RelPermalink }}" class="hidden w-full shadow-lg rounded-lg md:block" alt="{{ .Params.Cover.Title }}" loading="lazy"/>
    <a class="hidden text-right md:block text-sm text-red-700 mb-6" target="_blank" href="{{ .Params.Cover.Link }}">{{ .Params.Cover.Title }}</a>


    <h1 class="font-bold text-3xl mb-4">{{ .Title }}</h1>

    {{- partial "tags.html" . -}}

    {{ .Content }}

    {{ $currPermalink := .Page.RelPermalink }}
    {{ $similarPages := slice }}
    {{ range (.GetTerms "blog/tags") }}
    {{ $currTag := .LinkTitle }}
    {{ $taggedPages := (index .Site.Taxonomies "blog/tags" (replace (lower $currTag) " " "-")).Pages }}
    {{ range $taggedPages }}
    {{ if not (eq .RelPermalink $currPermalink) }}
    {{ $similarPages = $similarPages | append (slice .) }}
    {{ end }}
    {{ end }}
    {{ end }}

    {{ if gt (len $similarPages) 0 }}
    <h3 class="text-cyan-800">Similar articles</h3>
    <ul>
      {{ range first 5 ($similarPages | uniq) | shuffle }}
      <li><a href="{{ .Permalink }}">{{ .LinkTitle }}</a></li>
      {{ end }}
    </ul>
    {{ end }}

    <div id="cusdis_thread"
         data-host="https://cusdis.com"
         data-app-id="1bc4d68d-135f-4576-b476-ca6bc6f42586"
         data-page-id="{{ .File.UniqueID }}"
         data-page-url="{{ .Permalink }}"
         data-page-title="{{ .Title }}"
    ></div>
    <script async defer src="https://cusdis.com/js/cusdis.es.js"></script>

  </section>
</main>
{{ end }}